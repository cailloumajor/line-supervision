version: "3.7"

x-aliases:
  - &common-env-file ./.env.common

services:
  influx:
    env_file:
      - *common-env-file

  opcua-bridge:
    env_file:
      - *common-env-file
      - ./.env.opc

  web:
    env_file:
      - *common-env-file
    build: ./web/.devcontainer
    expose:
      - "8080"
    volumes:
      - .:/workspace:cached
    tty: true

  reverse-proxy:
    command:
      - "--api.dashboard=true"
      - "--api.insecure=true"
      - "--entryPoints.http.address=:8000"
      - "--log.level=WARN"
      - "--providers.docker=true"
      - "--providers.docker.endpoint=tcp://docker-socket-proxy:2375"
      - "--providers.docker.exposedByDefault=false"
      - "--providers.docker.network=net-backend-${COMPOSE_PROJECT_NAME:-4nf3wt}"
    ports:
      - "8080:8000"
      - "8088:8080"
